<MenuItem x:Class="CUIContextMenu.UserContextMenu"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
            xmlns:local="clr-namespace:CUIContextMenu"
            xmlns:account="clr-namespace:AccountModule;assembly=AccountModule"
            mc:Ignorable="d" 
            IsVisibleChanged="UserControl_IsVisibleChanged"
            Header="MaskingLevel"
            IsEnabled="True"
            Click="MenuItem_Click"
            ItemsSource="{Binding Source={x:Static account:AccountManager.MaskingLevelCollection}}"
            d:DesignHeight="400" d:DesignWidth="300"
          >
    <MenuItem.Resources>
        <local:MultiValueConverter x:Key="converter"/>
    </MenuItem.Resources>

    <MenuItem.ItemContainerStyle>
        <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
            <Setter Property="Background" Value="Gray"/>
            <!--<Setter Property="Command" Value="{Binding MenuItemClickCommand}"/>-->
        </Style>
        
    </MenuItem.ItemContainerStyle>
    
    <MenuItem.ItemTemplate>
        <DataTemplate>
            <Label VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                   VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch"
                   Content="{Binding}" Margin="0">
                <Label.Style>
                    <Style TargetType="Label" BasedOn="{StaticResource {x:Type Label}}">
                        <Setter Property="Background">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource converter}">
                                    <MultiBinding.Bindings>
                                        <Binding/>
                                        <Binding RelativeSource="{RelativeSource Mode=FindAncestor, 
                                                    AncestorType={x:Type local:UserContextMenu}}"
                                                 Path="ParentControl.SourceUI.MaskingLevel"
                                                 />
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Label.Style>
            </Label>
        </DataTemplate>
    </MenuItem.ItemTemplate>
</MenuItem>
