<UserControl x:Class="ProberDevelopPackWindow.Tab.RunGemView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ProberDevelopPackWindow.Tab"
             xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="1024" d:DesignWidth="1024">

    <UserControl.Resources>
        <local:StringToTextDocumentConverter x:Key="StringToTextDocumentConverter"/>

        <local:FolderFileIconConverter x:Key="FolderFileIconConverter"/>
        <local:FolderFileIconColorConverter x:Key="FolderFileIconColorConverter"/>

        <local:BoolToColorConverter x:Key="BoolToColorConverter" />
        <local:BoolToForegrounColorConverter x:Key="BoolToForegrounColorConverter" />
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Border BorderThickness="1" BorderBrush="DimGray">

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="5" MinWidth="5"/>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="5" MinWidth="5"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <TreeView ItemsSource="{Binding Folders}" VerticalAlignment="Stretch" AllowDrop="True"
                          SelectedItemChanged="TreeView_SelectedItemChanged"
                          KeyDown="TreeView_KeyDown">

                    <TreeView.Resources>

                        <SolidColorBrush x:Key="DragOverBackgroundBrush" Color="LightBlue"/>

                        <ContextMenu x:Key="FolderContextMenu">
                            <MenuItem Header="Create Folder" Command="{Binding DataContext.CreateFolderCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
                            <MenuItem Header="Delete Folder" Command="{Binding DataContext.DeleteFolderCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
                            <MenuItem Header="Create File" Command="{Binding DataContext.CreateFileCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
                            <MenuItem Header="Delete File" Command="{Binding DataContext.DeleteFileCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
                            <MenuItem Header="Rename" Command="{Binding Path=DataContext.RenameCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeView}}}" CommandParameter="{Binding}"/>
                        </ContextMenu>
                    </TreeView.Resources>

                    <TreeView.ItemContainerStyle>

                        <Style TargetType="TreeViewItem">
                            <Setter Property="ContextMenu" Value="{StaticResource FolderContextMenu}"/>
                            <EventSetter Event="PreviewMouseMove" Handler="TreeViewItem_PreviewMouseMove"/>
                            <EventSetter Event="Drop" Handler="TreeViewItem_Drop"/>
                            <EventSetter Event="DragEnter" Handler="TreeViewItem_DragEnter"/>
                            <EventSetter Event="DragLeave" Handler="TreeViewItem_DragLeave"/>
                            <EventSetter Event="MouseEnter" Handler="TreeViewItem_MouseEnter"/>
                            <EventSetter Event="MouseLeave" Handler="TreeViewItem_MouseLeave"/>

                            <!-- 배경색 변경을 위한 스타일 Setter 추가 -->
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource DragOverBackgroundBrush}"/>
                                </Trigger>
                            </Style.Triggers>

                        </Style>
                    </TreeView.ItemContainerStyle>

                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="{Binding IsFolder, Converter={StaticResource FolderFileIconConverter}}"
                                                         Foreground="{Binding IsFolder, Converter={StaticResource FolderFileIconColorConverter}}"
                                                         Width="20" Height="20"/>
                                <TextBlock Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>

                </TreeView>
            </Grid>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="DarkGray" />

            <Grid Grid.Column="2">

                <ListView ItemsSource="{Binding Messages}" SelectedItem="{Binding SelectedSecsMessage, Mode=TwoWay}" 
                          Margin="5">

                    <ListView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Edit Description" Command="{Binding EditDescriptionCommand}"/>
                        </ContextMenu>
                    </ListView.ContextMenu>

                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Name" DisplayMemberBinding="{Binding CommandName}"/>
                            <GridViewColumn Header="Description">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Description}">
                                            <TextBlock.ToolTip>
                                                <ToolTip>
                                                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap"/>
                                                </ToolTip>
                                            </TextBlock.ToolTip>
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="ToolTipService.InitialShowDelay" Value="0"/>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
                
            </Grid>

            <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch" Background="DarkGray" />

            <Grid Grid.Column="4" 
                  Visibility="{Binding GemActlistVisibility, Converter={StaticResource BoolToVisibilityConverter}}">
                <ListView ItemsSource="{Binding GemActlist}"
                          SelectedItem="{Binding SelectedGemAct}">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" 
                                       Foreground="{Binding IsIncluded, Converter={StaticResource BoolToForegrounColorConverter}}"
                                       Background="{Binding IsIncluded, Converter={StaticResource BoolToColorConverter}}" />
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>

            <Grid Grid.Column="5">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <GroupBox Header="Commands">

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <CheckBox Content="Show GEM Action List" IsChecked="{Binding GemActlistVisibility}"/>
                            </Grid>

                            <Grid Grid.Row="1">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0">
                                    <Button Command="{Binding AddMessageCommand}" Content="Add Message" Margin="5" IsEnabled="{Binding GemActlistVisibility}"/>
                                    <Button Command="{Binding DeleteMessageCommand}" Content="Delete Message" Margin="5"/>
                                    <Button Command="{Binding SaveMessageCommand}" Content="Save Message" Margin="5"/>
                                </StackPanel>
                            </Grid>

                            <Grid Grid.Row="2">
                                <CheckBox Content="Use Edited Message" IsChecked="{Binding UseEditedMessage}"/>
                            </Grid>

                            <Grid Grid.Row="3">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0">
                                    <Button Command="{Binding ExecuteMessageCommand}" Content="Execute Message" Margin="5"/>
                                </StackPanel>
                            </Grid>

                        </Grid>
                    </GroupBox>
                </Grid>

                <Grid Grid.Row="1">

                    <avalonEdit:TextEditor Name="multiLineTextBox" 
                       Margin="5"
                       SyntaxHighlighting="XML"
                       ShowLineNumbers="True"
                       FontFamily="Consolas" 
                       FontSize="12"
                       HorizontalScrollBarVisibility="Auto"
                       VerticalScrollBarVisibility="Auto"/>
                </Grid>
            </Grid>
        </Grid>

    </Border>
</UserControl>
