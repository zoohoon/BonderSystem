<UserControl x:Class="UCNeedleClean.UcNeedleCleanMainPage" x:Name="ucwindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:converter="clr-namespace:ValueConverters;assembly=ValueConverters"
             xmlns:local="clr-namespace:UCNeedleClean"
             mc:Ignorable="d"
             d:DesignHeight="920" d:DesignWidth="890">
    <UserControl.Resources>
        
        <ResourceDictionary>
            <Style x:Key="DefaultRepeatBtn" TargetType="RepeatButton">
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RepeatButton">
                            <Border Name="border" BorderThickness="0" BorderBrush="Black" Background="{TemplateBinding Background}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Opacity" Value="0.8" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="DefaultBtn" TargetType="Button">
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Name="border" BorderThickness="0" BorderBrush="Black" Background="{TemplateBinding Background}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Opacity" Value="0.8" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="DefaultLabel" TargetType="Label">
                <Setter Property="Margin" Value="18"/>
                <Setter Property="FontSize" Value="18"/>
                <Setter Property="Foreground" Value="Black"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
            </Style>

            <converter:HalfConverter x:Key="HalfConverter"/>
            <converter:GetCatCoordZValFromArrayConverter x:Key="GetCatCoordZValFromArrayConverter"/>
            <converter:NumIncreaseConverter x:Key="NumIncreaseConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Width="890" Height="920">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="1" Grid.Row="2">
                
                <Label  Grid.Row="0" Content="Measured height of sheet" FontSize="25" 
                                HorizontalAlignment="Center" 
                                VerticalAlignment="Top" 
                                Foreground="White" Margin="-40 40 0 0"/>
                <Label Visibility="{Binding NC.NCSheetVMDef.ResultVisibility}" 
                       Grid.Row="0" 
                       Content="{Binding NC.NCSheetVMDef.Index,
                       Converter={StaticResource NumIncreaseConverter},
                       ConverterParameter='1'}"
                       FontSize="45" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Top" 
                       Foreground="Yellow"
                       Margin="310 20 0 0"/>

                <ItemsControl ItemsSource="{Binding NC.NCSheetVMDefs}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Label  Visibility="{Binding ResultVisibility}"  
                                        HorizontalAlignment="Left" VerticalAlignment="Top" 
                                        Foreground="White" Margin="100 100 0 0"
                                        Content="{Binding Heights, 
                                        Converter={StaticResource GetCatCoordZValFromArrayConverter},
                                        ConverterParameter='0'}" ContentStringFormat="{}{0:N0}"
                                        Style="{StaticResource DefaultLabel}"/>
                                <Label  Visibility="{Binding ResultVisibility}" 
                                        HorizontalAlignment="Left" VerticalAlignment="Top"
                                        Foreground="White" Margin="100 300 0 0"
                                        Content="{Binding Heights, 
                                        Converter={StaticResource GetCatCoordZValFromArrayConverter},
                                        ConverterParameter='1'}" ContentStringFormat="{}{0:N0}"
                                        Style="{StaticResource DefaultLabel}"/>
                                <Label  Visibility="{Binding ResultVisibility}" 
                                        HorizontalAlignment="Center" VerticalAlignment="Top"
                                        Foreground="White" Margin="0 190 0 0"
                                        Content="{Binding Heights, 
                                        Converter={StaticResource GetCatCoordZValFromArrayConverter},
                                        ConverterParameter='2'}" ContentStringFormat="{}{0:N0}"
                                        Style="{StaticResource DefaultLabel}"/>
                                <Label  Visibility="{Binding ResultVisibility}" 
                                        HorizontalAlignment="Right" VerticalAlignment="Top"
                                        Foreground="White" Margin="0 100 100 0"
                                        Content="{Binding Heights, 
                                        Converter={StaticResource GetCatCoordZValFromArrayConverter},
                                        ConverterParameter='3'}" ContentStringFormat="{}{0:N0}"
                                        Style="{StaticResource DefaultLabel}"/>
                                <Label  Visibility="{Binding ResultVisibility}" 
                                        HorizontalAlignment="Right" VerticalAlignment="Top" 
                                        Foreground="White" Margin="0 300 100 0"
                                        Content="{Binding Heights, 
                                        Converter={StaticResource GetCatCoordZValFromArrayConverter},
                                        ConverterParameter='4'}" ContentStringFormat="{}{0:N0}"
                                        Style="{StaticResource DefaultLabel}"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>                
            </Grid>

            <!--<ItemsControl ItemsSource="{Binding SheetDefs}" Grid.Column="1" Grid.Row="2">            
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition/>                               
                            </Grid.RowDefinitions>
                                                        
                            --><!--Show current sheet number--><!--
                            <Label  Grid.Row="0" Content="Measured height of sheet" FontSize="25" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Top" 
                                    Foreground="White" Margin="-40 40 0 0"/>
                            <Label Visibility="{Binding SheetDef.ResultVisibility}" Grid.Row="0" Content="{Binding SheetDef.Index}" FontSize="25" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Top" 
                                    Foreground="White"
                                    Margin="290 40 0 0"/>
                            
                            <Label Visibility="{Binding ResultVisibility}"  HorizontalAlignment="Left" VerticalAlignment="Top" Foreground="White" Margin="100 100 0 0"
                                    Content="{Binding Heights[0].Z.Value}" ContentStringFormat="{}{0:N0}"
                                    Style="{StaticResource DefaultLabel}"/>
                                            <Label Visibility="{Binding ResultVisibility}" HorizontalAlignment="Left" VerticalAlignment="Top" Foreground="White" Margin="100 300 0 0"
                                    Content="{Binding Heights[1].Z.Value}" ContentStringFormat="{}{0:N0}"
                                    Style="{StaticResource DefaultLabel}"/>
                                            <Label Visibility="{Binding ResultVisibility}"  HorizontalAlignment="Center" VerticalAlignment="Top" Foreground="White" Margin="0 190 0 0"
                                    Content="{Binding Heights[2].Z.Value}" ContentStringFormat="{}{0:N0}"
                                    Style="{StaticResource DefaultLabel}"/>
                                            <Label Visibility="{Binding ResultVisibility}"  HorizontalAlignment="Right" VerticalAlignment="Top" Foreground="White" Margin="0 100 100 0"
                                    Content="{Binding Heights[3].Z.Value}" ContentStringFormat="{}{0:N0}"
                                    Style="{StaticResource DefaultLabel}"/>
                                            <Label Visibility="{Binding ResultVisibility}"  HorizontalAlignment="Right" VerticalAlignment="Top" Foreground="White" Margin="0 300 100 0"
                                    Content="{Binding Heights[4].Z.Value}" ContentStringFormat="{}{0:N0}"
                                    Style="{StaticResource DefaultLabel}"/>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>-->

            <!--Width="{Binding NeedleCleanPadWidth}" 
                          Height="{Binding NeedleCleanPadHeight}"-->
            
            <ItemsControl ItemsSource="{Binding NC.NCSheetVMDefs}"
                          Width="{Binding NC.NeedleCleanPadWidth}" 
                          Height="{Binding NC.NeedleCleanPadHeight}"
                           HorizontalAlignment="Left"
                          Grid.Row="0" Grid.Column="1" Margin="0 60 0 0">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas>
                            <Canvas.Background>
                                
                                <VisualBrush TileMode="Tile" Stretch="Uniform" Viewport="0,0,40,40" ViewportUnits="Absolute">
                                    <VisualBrush.Visual>
                                        <Rectangle Width="10" Height="10" Fill="Black" Stroke="Beige"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>

                                
                                <!--<DrawingBrush Viewport="0,0,50,50" ViewportUnits="Absolute" TileMode="Tile">
                                    <DrawingBrush.Drawing>
                                        <DrawingGroup>
                                            <GeometryDrawing Geometry="M0,0 L1,0.01 1,0.03, 0,0.04Z" Brush="Beige"/>
                                            <GeometryDrawing Geometry="M0,0 L0,1 0.01,1, 0.01,0Z" Brush="Beige" />
                                            --><!--<GeometryDrawing Geometry="M0,0 L1,0 1,0.05, 0,0.05Z" Brush="Red" />
                                            <GeometryDrawing Geometry="M0,0 L0,1 0.1,1, 0.1,0Z" Brush="Red" />-->

                                            <!--<GeometryDrawing Geometry="M 0,0 L 0,1 1,1 1,0 0,0" Brush="Beige"/>
                                            <GeometryDrawing Geometry="M 0.05,0.05 L 0.05,0.95 0.95,0.95 0.95,0.05 0.05,0.05" Brush="Black"/>-->                                            
                                            <!--<GeometryDrawing Geometry="M 0.5,0.5 L 0.5,9.5 9.5,9.5 9.5,0.5 0.5,0.5" Brush="Black"/>--><!--
                                        </DrawingGroup>
                                    </DrawingBrush.Drawing>
                                </DrawingBrush>-->
                            </Canvas.Background>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseDown">
                                    <i:InvokeCommandAction Command="{Binding MouseDownCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseUp">
                                    <i:InvokeCommandAction Command="{Binding MouseUpCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseMove">
                                    <i:InvokeCommandAction Command="{Binding MouseMoveCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseLeave">
                                    <i:InvokeCommandAction Command="{Binding MouseUpCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </Canvas>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Canvas.Left" Value="{Binding SheetLeft}"/>
                        <Setter Property="Canvas.Top" Value="{Binding SheetTop}"/>
                        <Setter Property="Panel.ZIndex" Value="{Binding SelectIndex}"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
                
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <Rectangle Width="{Binding SheetWidth}" Height="{Binding SheetHeight}" 
                                       Fill="Beige" Opacity="0.8" Stroke="Red" StrokeDashArray="4 0" StrokeThickness="5" Visibility="{Binding ResultVisibility}">
                            </Rectangle>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            
            <!--Top and Left side ruler-->
            <Border Grid.Row="0" Grid.ColumnSpan="3">
                <local:UcNeedleCleanColumn
                    Width="{Binding NeedleCleanPadWidth}"                                     
                    VerticalContentAlignment="Top"
                    Margin="0 15 0 0"
                    />
            </Border>
            <Border Grid.Row="0" Grid.Column="0">
                <local:UcNeedleCleanRow
                    Height="{Binding NeedleCleanPadHeight}"                    
                    HorizontalContentAlignment="Right"
                    VerticalContentAlignment="Top"
                    Margin="0 60 0 0"/>
            </Border>


        </Grid>
    </Grid>
</UserControl>

