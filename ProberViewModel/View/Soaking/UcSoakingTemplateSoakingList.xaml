<UserControl x:Class="SoakingSettingView.UcSoakingTemplateSoakingList"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:local="clr-namespace:SoakingSettingView"
             xmlns:s="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             x:Name="SoakingTemplateSoakingList" 
             >
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <local:ValueOffsetConverter x:Key="ValueOffsetConverter"/>
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>

    </UserControl.Resources>
    <Grid Grid.Column="2" Margin="0, 10, 0, 10" x:Name="G3X4D" Background="#000000">
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="10" />
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="130"/>
                <ColumnDefinition Width="140"/>
                <ColumnDefinition Width="220"/>
            </Grid.ColumnDefinitions>

            <Label Grid.Column="0" Content="Step" FontSize="12" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0" Foreground="White" ></Label>
            <Label Grid.Column="1" Content="Time (Sec)" FontSize="12"  FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0" Foreground="White"></Label>
            <Label Grid.Column="2" Content="OD (um)" FontSize="12"  FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0" Foreground="White"></Label>
        </Grid>
        <Grid Grid.Row="1" Margin="15, 0, 40, 0" Width="440" Background="DarkRed" HorizontalAlignment="Left"/>

        <Grid Grid.Row="2" x:Name="G3X4E">
            <ListView Grid.Row="1" 
                                MaxHeight="{Binding ActualHeight, ElementName=G3X4D, Converter={StaticResource ValueOffsetConverter}, ConverterParameter='-60' }"
                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                VirtualizingPanel.IsContainerVirtualizable="True"
                                VirtualizingPanel.IsVirtualizing="True"
                                VirtualizingPanel.VirtualizationMode="Recycling"
                                ScrollViewer.CanContentScroll="True"
                                SelectionMode="Single" 
                                Margin="20, 0, 15, 0"
                        ItemsSource="{Binding EditSteps, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                SelectedItem="{Binding SelectedStep,Mode=TwoWay}"
                                >
                <ListView.Resources>
                    <s:Double x:Key="{x:Static SystemParameters.VerticalScrollBarWidthKey}">40</s:Double>
                    <s:Double x:Key="{x:Static SystemParameters.VerticalScrollBarButtonHeightKey}">40</s:Double>

                    <Style TargetType="GridViewColumnHeader">
                        <Setter Property="Visibility" Value="Collapsed" />
                    </Style>
                </ListView.Resources>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="Height" Value="45" />
                    </Style>
                </ListView.ItemContainerStyle>

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="180"/>
                                    <ColumnDefinition Width="180"/>
                                </Grid.ColumnDefinitions>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="30"/>
                                    <RowDefinition Height="15"/>
                                </Grid.RowDefinitions>

                                <Label Grid.Row="0" Grid.Column="0"
                                                        Content="{Binding StepIdx.Value}" 
                                                        FontSize="13" Margin="0" Padding="0"
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalAlignment="Bottom"
                                        Foreground="White"
                                        >
                                    <Label.Style>
                                        <Style TargetType="{x:Type Label}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepIdx.Value  }" Value="{x:Static s:Int32.MaxValue}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>
                                <Label Grid.Row="0" Grid.Column="0"
                                                        Content="Last Step" 
                                                        FontSize="13" Margin="0" Padding="0"
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalAlignment="Bottom"
                                        Foreground="White"
                                        >
                                    <Label.Style>
                                        <Style TargetType="{x:Type Label}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepIdx.Value  }" Value="{x:Static s:Int32.MaxValue}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>

                                <Border Grid.Row="0" Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBox Grid.Row="0" Grid.Column="1"
                                                            Name="SoakingStepSoakingTime_tb"
                                                        Text="{Binding TimeSec.Value}" 
                                                        Width="100"
                                                           
                                                        Background="Transparent"
                                                        FontSize="13" Margin="0"   
                                                        BorderBrush="White"
                                                           
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalAlignment="Bottom"   Foreground="White">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="PreviewMouseDown" >
                                                <i:InvokeCommandAction Command="{Binding DataContext.TextBoxClickCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TextBox}}}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                    <Border.Style>
                                        <Style TargetType="{x:Type Border}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepIdx.Value  }" Value="{x:Static s:Int32.MaxValue}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                                <Border Grid.Row="0" Grid.Column="1" HorizontalAlignment="Center" Margin="0" Padding="0">
                                    <Label Grid.Row="0" Grid.Column="1"
                                                        Content="Remain Time" 
                                                        Width="150"
                                                        Background="Transparent"
                                                        FontSize="13" Margin="0"   
                                                        BorderBrush="White"
                                                        BorderThickness="{Binding SoakingTimeSecBorderThickness}"
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalAlignment="Bottom"  Foreground="DimGray">
                                    </Label>
                                    <Border.Style>
                                        <Style TargetType="{x:Type Border}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepIdx.Value  }" Value="{x:Static s:Int32.MaxValue}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>

                                <Border Grid.Row="0" Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBox Text="{Binding OD_Value.Value}" 
                                                        Width="100"
                                                        FontSize="13" Margin="0"
                                                        Background="Transparent"
                                                            Foreground="White"
                                                        BorderBrush="White"
                                                        BorderThickness="0, 0, 0, 1"
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalAlignment="Bottom">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="PreviewMouseDown" >
                                                <i:InvokeCommandAction Command="{Binding DataContext.TextBoxClickCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TextBox}}}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                </Border>

                                <Border Grid.Row="1" Grid.ColumnSpan="3"
                                                Height="5"
                                                Margin="0, 0, 25, 0"
                                                    Background="#AAAC00">
                                    <Border.Style>
                                        <Style TargetType="{x:Type Border}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StepIdx.Value  }" Value="{x:Static s:Int32.MaxValue}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <Grid Grid.Row="3" Margin="15, 0, 40, 0" Width="440" Background="DarkRed" HorizontalAlignment="Left"/>
    </Grid>
</UserControl>
