<!--View Model : PNPSetupBase class-->
<UserControl 
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
            xmlns:UcDisplayPort="clr-namespace:UcDisplayPort;assembly=UcDisplayPort"
            xmlns:local="clr-namespace:PnPControl.UserControls"
            xmlns:pi="clr-namespace:ProberInterfaces.PnpSetup;assembly=ProberInterfaces"
            xmlns:pialignex="clr-namespace:ProberInterfaces.AlignEX;assembly=ProberInterfaces"
            xmlns:UcCircularShapedJog="clr-namespace:UcCircularShapedJog;assembly=UcCircularShapedJog"
            xmlns:UcPnPButtonJog="clr-namespace:UcPnPButtonJog;assembly=UcPnPButtonJog"                         
            xmlns:UcPnPPrevNextJog="clr-namespace:UcPnPPrevNextJog;assembly=UcPnPPrevNextJog"
            xmlns:UcPnPPlusMinusJog="clr-namespace:UcPnPPlusMinusJog;assembly=UcPnPPlusMinusJog"
            xmlns:MapView="clr-namespace:MapView;assembly=MapView"
            xmlns:Dutview="clr-namespace:DutView;assembly=DutView"
            xmlns:prober="clr-namespace:ProberInterfaces;assembly=ProberInterfaces"
            xmlns:Pin="clr-namespace:ProberInterfaces.PinAlign.ProbeCardData;assembly=ProberInterfaces"
            xmlns:cam="clr-namespace:CameraModule;assembly=CameraModule"
            xmlns:pc="clr-namespace:ProberInterfaces.PinAlign.ProbeCardData;assembly=ProberInterfaces"
            xmlns:sub="clr-namespace:SubstrateObjects;assembly=SubstrateObjects"
            xmlns:pnp="clr-namespace:PnPControl"
            xmlns:tempSelector="clr-namespace:DataTemplateService;assembly=DataTemplateService"
            xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"            
            xmlns:hjc="clr-namespace:HexagonJogControl;assembly=HexagonJogControl"
            xmlns:lj="clr-namespace:LightJog;assembly=LightJog"
            xmlns:review="clr-namespace:RecipeEditorMainPageView;assembly=RecipeEditorMainPageView"
            xmlns:reviewmodel="clr-namespace:RecipeEditorMainPageViewModel;assembly=RecipeEditorMainPageViewModel"
            xmlns:ValueConvert="clr-namespace:ValueConverters;assembly=ValueConverters"
            x:Class="PnPControl.UserControls.UcPnPSetup"            
            mc:Ignorable="d" 
            d:DesignHeight="892" d:DesignWidth="1280" Background="Transparent" x:Name="PNPSetupControl" Loaded="PNPSetupControl_Loaded">

    <UserControl.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="DisplayViewTemplate" DataType="{x:Type prober:IDisplayPort}" >
                <!--<UcDisplayPort:DisplayPort x:Name="DisPlay"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"/>-->
                <ContentControl Name="DisPlay" Content="{Binding }">
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="MapViewTemplate" DataType="{x:Type prober:IWaferObject}" >
                <MapView:MapViewControl MinHeight="200" MinWidth="200" Opacity="1" 
                                              WaferObject="{Binding }" Grid.RowSpan="2" Margin="4" 
                                              CurrXIndex="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, 
                                                        Path=DataContext.CurCam.CamSystemMI.XIndex, Mode=TwoWay}" 
                                              CurrYIndex="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, 
                                                        Path=DataContext.CurCam.CamSystemMI.YIndex, Mode=TwoWay}"
                                              CurCamera="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, Path=DataContext.CurCam}" 
                                              ZoomLevel="{Binding ZoomLevel, Mode=TwoWay}"/>
            </DataTemplate>
            <DataTemplate x:Key="DutViewTemplate" DataType="{x:Type Pin:IProbeCard}" >
                <Dutview:DutViewControl ProbeCard="{Binding }"
                                                CoordXOffset="13"
                                                CoordYOffset="115"                                                
                                                PinRegistrationEnable = "{Binding ProbeCard.isPinRegProc}"
                                                PinGroupingEnable = "{Binding ProbeCard.isPinGroupProc}"/>            
            </DataTemplate>
            <DataTemplate x:Key="RecipeEditTemplate" DataType="{x:Type reviewmodel:VmRecipeEditorMainPage}">
                <review:UcRecipeEditorMainPage/>
            </DataTemplate>
            <local:TemplateSelector x:Key="ViewTargetTemplateSelector" 
                                    MapViewDataTemplate="{StaticResource MapViewTemplate}"
                                    DutViewDataTemplate="{StaticResource DutViewTemplate}"
                                    DisplayViewDataTemplate="{StaticResource DisplayViewTemplate}"
                                    RecipeEditDataTemplate="{StaticResource RecipeEditTemplate}"/>
            <ValueConvert:SetupStateImageConvert x:Key="SetupImageConverter"/>
            <ValueConvert:TreeviewItemVisibleConverter x:Key="TreeItemVisibleConverter"/>
            <ValueConvert:IsSetupTypeConverter x:Key="IsSetupTypeToBoolConv"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="892"/>
            <ColumnDefinition Width="270*"/>
        </Grid.ColumnDefinitions>

        <!--Left Side-->
        <Grid Grid.Column="0" Margin="4">
            <ContentControl Content="{Binding MainViewTarget}"  Width="890" Height="890"
                            ContentTemplateSelector="{StaticResource ViewTargetTemplateSelector}"/>

            <!--<Button Style="{x:Null}" Command="{Binding}" 
                    HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="16">
                <Button.Content>
                    <Image Source="{Binding}" ></Image>
                </Button.Content>
            </Button>-->
            <Image Source="{Binding MainViewImageSource}"  HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="16"
                   Width="250" Height="250"/>
        </Grid>
        <Grid Grid.Row="0" Width="250" Height="250" VerticalAlignment="Top" HorizontalAlignment="Right" Opacity="1" Margin="8,20">


            <ContentControl Content="{Binding MiniViewTarget}" 
                            ContentTemplateSelector="{StaticResource ViewTargetTemplateSelector}" Opacity="0.7"/>
            <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Opacity="0.25" Visibility="{Binding SwitchVisiability}" >
                <Button Content="↔" Background="Black" Foreground="White" Command="{Binding ViewSwipCommand}" Width="50" Height="50" FontSize="40" FontWeight="Black"/>
                <RepeatButton Visibility="{Binding MiniViewZoomVisible }" HorizontalAlignment="Right" VerticalAlignment="Top" Content="+" Background="Black" Foreground="White" Command="{Binding PlusCommand}" Width="50" Height="50" FontSize="40" FontWeight="Black" />
                <RepeatButton Visibility="{Binding MiniViewZoomVisible }" HorizontalAlignment="Right" VerticalAlignment="Top" Content="-" Background="Black" Foreground="White" Command="{Binding MinusCommand}" Width="50" Height="50" FontSize="40" FontWeight="Black" />
            </StackPanel>
        </Grid>
        <!--<StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="4,0,0,-650" >
            <StackPanel VerticalAlignment="Top" Opacity="0.25">
                <Button Content=" Set Zero" Background="Black" Foreground="White" 
                    Command="{Binding SetZeroCommand}" Width="120" Height="40" FontSize="22" FontWeight="Black"/>
            </StackPanel>
        </StackPanel>-->

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Visibility="{Binding LightJogVisiability}" >
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <StackPanel VerticalAlignment="Center" Opacity="0.25" Grid.Row="0">
                    <Button Content=" Set Zero" Background="Black" Foreground="White" 
                    Command="{Binding SetZeroCommand}" Width="150" Height="50" FontSize="25" FontWeight="Black"/>
                </StackPanel>
                <StackPanel VerticalAlignment="Top" Opacity="0.25" Grid.Row="1" >
                    <RepeatButton Visibility="{Binding MainViewZoomVisible}" HorizontalAlignment="Right" VerticalAlignment="Top" 
                              Content="+" Background="Black" Foreground="White" Command="{Binding PlusCommand}" Width="50" Height="50" FontSize="40" FontWeight="Black" />
                    <RepeatButton Visibility="{Binding MainViewZoomVisible}" HorizontalAlignment="Right" VerticalAlignment="Top" 
                              Content="-" Background="Black" Foreground="White" Command="{Binding MinusCommand}" Width="50" Height="50" FontSize="40" FontWeight="Black" />
                </StackPanel>
                <Viewbox Grid.Row="1" Width="200" Height="150" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,10,10" >
                    <lj:UcLightJog  Width="200" Height="150" Opacity="0.9"/>
                </Viewbox>
            </Grid>
        </StackPanel>

        <!--Right Side-->
        <Grid Grid.Column="1" Margin="8" >
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="300*"/>
                    <!--Treeview-->
                    <RowDefinition Height="400*"/>
                    <!--MiddleJog & Button-->
                    <RowDefinition Height="330*"/>
                    <!--MotionJog-->
                </Grid.RowDefinitions>
                <Grid.Resources>
                    <Style x:Key="TreeViewItemStyle1" TargetType="TreeViewItem">
                        <Setter Property="TreeViewItem.IsExpanded" Value="True"/>

                        <!--<Style.Triggers>
                            <DataTrigger Binding="{Binding IsVisible}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsVisible}" Value="False">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>-->

                        <Setter Property="TreeViewItem.IsSelected" Value="{Binding Path=IsSeleted, Mode=TwoWay}"/>
                        <Setter Property="TreeViewItem.Margin" Value="0 5 0 0 "/>


                        <Style.Triggers>
                            <Trigger Property="TreeViewItem.DataContext" Value="True">
                                <Setter Property="TreeViewItem.Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}" />
                            </Trigger>
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Converter={StaticResource IsSetupTypeToBoolConv}}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Resources>

                <Border Grid.Row="0"  Background="Black"  BorderThickness="1" BorderBrush="#FF343434">
                    <TreeView ItemsSource="{Binding Prober.PnpSetupScreen}" Name="PnpSetupView"  HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" 
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled" ItemContainerStyle="{StaticResource TreeViewItemStyle1}">
                        <TreeView.Resources>
                            <Style x:Key="{x:Type ScrollBar}" TargetType="{x:Type ScrollBar}">
                                <Setter Property="MinWidth" Value="25" />
                                <Setter Property="Width" Value="25" />
                            </Style>

                        </TreeView.Resources>

                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="SelectedItemChanged">
                                <i:InvokeCommandAction Command="{Binding SetupStepChangedCommand}" CommandParameter="{Binding SelectedValue, ElementName=PnpSetupView}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>

                        <!--<i:Interaction.Behaviors>
                            <pnp:BindableSelectedItemBehavior SelectedItem="{Binding SeletedStep ,Mode=TwoWay}">
                            </pnp:BindableSelectedItemBehavior>
                        </i:Interaction.Behaviors>-->

                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding PnpSteps}" DataType="{x:Type pi:IPnp}" >
                                <HierarchicalDataTemplate.Triggers>
                                    <Trigger Property="TreeViewItem.IsSelected" Value="True">
                                        <Setter Property="TreeViewItem.Background" Value="Orange" />
                                    </Trigger>
                                </HierarchicalDataTemplate.Triggers>
                                <Border  Width="300" Background="#FF343434" BorderThickness="1" BorderBrush="White">
                                    <TextBlock Text="{Binding Name}" Foreground="White" Height="30" FontSize="15" Background="Transparent" Margin="5,0,0,0"></TextBlock>
                                </Border>
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Categories}"  DataType="{x:Type pialignex:ICategoryModule}">
                                        <Border Width="290" Margin="-10,0,0,0" Background="#FF343434" BorderThickness="1" BorderBrush="White">
                                            <StackPanel Orientation="Horizontal">
                                                <Image Source="{Binding ProcessingType, Converter={StaticResource SetupImageConverter}}" MaxHeight="18" MaxWidth="18"/>
                                                <TextBlock Text="{Binding Name}" Foreground="White" Height="30" FontSize="15" Background="Transparent" Margin="5,0,0,0"></TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </HierarchicalDataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>


                        <!--<TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Categories}" DataType="{x:Type pi:ICategory}" >
                                <HierarchicalDataTemplate.Triggers>
                                    <Trigger Property="TreeViewItem.IsSelected" Value="True">
                                        <Setter Property="TreeViewItem.Background" Value="Orange" />
                                    </Trigger>
                                    
                                </HierarchicalDataTemplate.Triggers>
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Categories}"  DataType="{x:Type pi:ModuleInfo}">
                                        <HierarchicalDataTemplate.ItemTemplate>
                                            <HierarchicalDataTemplate ItemsSource="{Binding AlignModule}"  DataType="{x:Type pi:ISetup}">
                                                <Border Width="290" Margin="-10,0,0,0" Background="#FF343434" BorderThickness="1" BorderBrush="White">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding Name}" Foreground="White" Height="30" FontSize="15" Background="Transparent" Margin="5,0,0,0"></TextBlock>
                                                    </StackPanel>
                                                </Border>
                                            </HierarchicalDataTemplate>
                                        </HierarchicalDataTemplate.ItemTemplate>
                                        <Border Width="290" Margin="-10,0,0,0" Background="#FF343434" BorderThickness="1" BorderBrush="White">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" Foreground="White" Height="30" FontSize="15" Background="Transparent" Margin="5,0,0,0"></TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </HierarchicalDataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>

                                <Border  Width="300" Background="#FF343434" BorderThickness="1" BorderBrush="White">
                                    <TextBlock Text="{Binding Name}" Foreground="White" Height="30" FontSize="15" Background="Transparent" Margin="5,0,0,0"></TextBlock>
                                </Border>
                            </HierarchicalDataTemplate>

                        </TreeView.ItemTemplate>-->
                    </TreeView>
                </Border>

                <Grid Grid.Row="1" >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="60*"/>
                        <!--CrossJogTitle-->
                        <RowDefinition Height="400*"/>
                        <!--CrossJog-->
                        <RowDefinition Height="150*"/>
                        <!--Buttons-->
                    </Grid.RowDefinitions>
                    <!--<Button HorizontalAlignment="Left"  Width="30" Click="Button_Click"></Button>-->
                    <Label Content="{Binding StepLabel}" FontSize="15" FontWeight="Bold" Background="Black"  Foreground="White" HorizontalAlignment="Center" HorizontalContentAlignment="Center" Width="250" Margin="0,3,0,0"/>
                    <Button Margin="0" HorizontalAlignment="Right" Width="50" Height="25" Content="Verify" FontSize="15" FontWeight="Bold" Background="Black" Command="{Binding CmdVerify}"></Button>
                    <Grid Grid.Row="1" HorizontalAlignment="Center">
                        <Viewbox>
                            <UcPnPPrevNextJog:PnPPrevNext MinWidth="320" MinHeight="250"/>
                        </Viewbox>
                        
                    </Grid>

                    <Grid Grid.Row="1" HorizontalAlignment="Center">
                        <Viewbox>
                            <UcCircularShapedJog:CircularJog />
                        </Viewbox>
                    </Grid>

                    <Grid Grid.Row="2" HorizontalAlignment="Center">
                        <Viewbox Width="300" Margin="0 10 0 0">
                            <UcPnPButtonJog:PnPButton />
                        </Viewbox>
                    </Grid>
                </Grid>

                <Viewbox Grid.Row="2" Grid.Column="1">
                    <hjc:UcHexagonJog DataContext="{Binding Prober._StageSuperVisor.PnpMotionJog}" MinHeight="300" MinWidth="300"  
                                      AssignedCamera="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, Path=DataContext.CurCam}"
                                      IsEnabled="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, Path=DataContext.MotionJobEnabled}"/>
                </Viewbox>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
