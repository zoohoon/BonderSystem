<Window x:Class="SignalTowerDialogServiceProvider.SignalTowerDisplayDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SignalTowerDialogServiceProvider"
             mc:Ignorable="d" x:Name="ucWindow"               
             d:DesignHeight="640" d:DesignWidth="800">
    <Window.Resources>
        <local:ColorToBrushConverter x:Key="ColorToBrushConv"/>
        <local:ListViewOpacityConverter x:Key="ListViewOpacityConv"/>
        <local:ListViewConverter x:Key="ListViewConv"/>
    </Window.Resources>
    <Grid VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
          Margin="0 20">
        <Grid.RowDefinitions>
            <RowDefinition Height="8*"/>
            <RowDefinition Height="40*"/>
            <RowDefinition Height="40*"/>
            <RowDefinition Height="40*"/>
            <RowDefinition Height="40*"/>
        </Grid.RowDefinitions>
        <!--<TextBlock Grid.Row="0" Grid.Column="1" Text="ON" HorizontalAlignment="Center" FontSize="15"/>
        <TextBlock Grid.Row="0" Grid.Column="2" Text="BLINK" HorizontalAlignment="Center" FontSize="15"/>-->

        <ListView Grid.Row="1" Grid.RowSpan="4" ItemsSource="{Binding SignalTowerManager.SignalTowerUnits}">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="VerticalContentAlignment" Value="Stretch" />
                    <Setter Property="IsSelected" Value="{Binding DataContext.IsSelected, Mode=TwoWay}"/>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="4"/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
            <ListView.ItemTemplate>
                <DataTemplate >
                    <Border BorderThickness="3" BorderBrush="{Binding Color, Converter={StaticResource ColorToBrushConv}}">
                        <Border BorderThickness="3" >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>
                                <Rectangle Grid.Column="0" >
                                    <!--<Rectangle.Fill>
                                        <MultiBinding UpdateSourceTrigger="PropertyChanged" Converter="{StaticResource ListViewOpacityConv}">
                                            <Binding Path="Color"/>
                                            <Binding Path="OnQueue.Count" />
                                            <Binding Path="BlinkQueue.Count" />
                                        </MultiBinding>
                                    </Rectangle.Fill>-->
                                    <Rectangle.Style >
                                        <Style TargetType="{x:Type Rectangle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding BlinkQueue.Count, Converter={StaticResource ListViewConv}}" Value="True" >
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard >
                                                            <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                                <DoubleAnimation From="0" To="1" Duration="0:0:0.5" Storyboard.TargetProperty="Opacity"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                    <DataTrigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard FillBehavior="Stop">
                                                                <DoubleAnimation To="0" Duration="0:0:0.5" Storyboard.TargetProperty="Opacity"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.ExitActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                            <Setter Property="Fill" >
                                                <Setter.Value>
                                                    <Binding Path="Color" Converter="{StaticResource ColorToBrushConv}"/>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="Opacity">
                                                <Setter.Value>
                                                    <MultiBinding Converter="{StaticResource ListViewOpacityConv}">
                                                        <Binding Path="OnQueue.Count" />
                                                        <!--<Binding Path="OnQueue.Count" />-->
                                                        <Binding Path="BlinkQueue.Count"/>
                                                        <!--<Binding Path="Label"/>-->
                                                        <!--<Binding Path="BlinkQueue.Count" UpdateSourceTrigger="PropertyChanged" NotifyOnSourceUpdated="True" BindsDirectlyToSource="True" />-->
                                                    </MultiBinding>
                                                </Setter.Value>
                                                
                                            </Setter>
                                        </Style>
                                    </Rectangle.Style>
                                </Rectangle>
                                <TextBlock Text="{Binding Label}" FontSize="40" TextAlignment="Center" Foreground="Gray" />
                                <!--<Button Grid.Column="1" Content="+" Command="{Binding DataContext.cmdOnEnqueueButtonClick, ElementName=ucWindow}">
                                    <Button.CommandParameter>
                                        <MultiBinding Converter="{StaticResource ListViewConverter}">
                                            <Binding Path=""/>
                                        </MultiBinding>
                                    </Button.CommandParameter>
                                </Button>
                                <Button Grid.Column="2" Content="-" Command="{Binding DataContext.cmdOnDequeueButtonClick, ElementName=ucWindow}" >
                                    <Button.CommandParameter>
                                        <MultiBinding Converter="{StaticResource ListViewConverter}">
                                            <Binding Path=""/>
                                        </MultiBinding>
                                    </Button.CommandParameter>
                                </Button>
                                <Button Grid.Column="3" Content="+" Command="{Binding DataContext.cmdBlinkEnqueueButtonClick, ElementName=ucWindow}" Visibility="{Binding Type,Converter={local:StringToVisibilityConverter}}">
                                    <Button.CommandParameter>
                                        <MultiBinding Converter="{StaticResource ListViewConverter}">
                                            <Binding Path=""/>
                                        </MultiBinding>
                                    </Button.CommandParameter>
                                </Button>
                                <Button Grid.Column="4" Content="-" Command="{Binding DataContext.cmdBlinkDequeueButtonClick, ElementName=ucWindow}" Visibility="{Binding Type,Converter={local:StringToVisibilityConverter}}">
                                    <Button.CommandParameter>
                                        <MultiBinding Converter="{StaticResource ListViewConverter}">
                                            <Binding Path=""/>
                                        </MultiBinding>
                                    </Button.CommandParameter>
                                </Button>-->
                            </Grid>
                        </Border>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</Window>
