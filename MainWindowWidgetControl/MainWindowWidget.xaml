<Controls:MetroWindow x:Class="MainWindowWidgetControl.MainWindowWidget"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                      xmlns:tg="clr-namespace:TempGraphControl;assembly=TempGraphControl"
                      xmlns:prober="clr-namespace:ProberInterfaces;assembly=ProberInterfaces"
                      xmlns:local="clr-namespace:MainWindowWidgetControl"
                      xmlns:needle="clr-namespace:NeedleCleanViewer;assembly=NeedleCleanViewer"
                      xmlns:MapUC="clr-namespace:MapView;assembly=MapView"
                      xmlns:pnpcontrol="clr-namespace:PnPControl;assembly=PnPControl"
                      xmlns:conv="clr-namespace:ValueConverters;assembly=ValueConverters"
                      xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
                      BorderThickness="1"
                      SizeToContent="WidthAndHeight" 
                      AllowsTransparency="True"
                      KeyDown="Window_KeyDown"
                      WindowStyle="None" ResizeMode="NoResize" Topmost="False" ShowTitleBar="True" ShowCloseButton="True"
                      Closing="MetroWindow_Closing"
                      mc:Ignorable="d" 
                      d:DesignHeight="350" d:DesignWidth="600"
                      GlowBrush="Black" Title="{Binding Title, StringFormat=POS [{0}]}">
    <!--GlowBrush="{Binding LotOPModule.CurrentModuleState, Converter={StaticResource BtoVConv}}">-->
    <Window.Resources>
        <ResourceDictionary>

            <conv:StateToColorConverter x:Key="BtoVConv" />
            <DataTemplate x:Key="DisplayViewTemplate" DataType="{x:Type prober:IDisplayPort}" >
                <ContentControl Name="DisPlay" Content="{Binding }">
                </ContentControl>
            </DataTemplate>

            <DataTemplate x:Key="MapViewTemplate" DataType="{x:Type prober:IWaferObject}" >
                <MapUC:MapViewControl  Opacity="1" 
                                             WaferObject="{Binding }" 
                                             UnderDutDices="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, 
                                                           Path=DataContext.ProbingModule.ProbingProcessStatus.UnderDutDevs, Mode=TwoWay}" 
                                            Grid.RowSpan="2" Margin="4" 
                                              CursorXIndex="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}}, 
                                                           Path=DataContext.ProbingModule.ProbingMXIndex, Mode=TwoWay}" 
                                              CursorYIndex="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type UserControl}},
                                                            Path=DataContext.ProbingModule.ProbingMYIndex, Mode=TwoWay}" 
                                              EnalbeClickToMove="False"
                                              ZoomLevel="{Binding ZoomLevel, Mode=TwoWay}"
                                             CoordinateManager="{Binding RelativeSource={RelativeSource Mode=FindAncestor, 
                                                         AncestorType={x:Type UserControl}}, Path=DataContext.CoordinateManager, Mode=TwoWay}"
                                             IsCrossLineVisible="False"
                                             RenderMode="{Binding MapViewControlMode}"/>
            </DataTemplate>

            <DataTemplate x:Key="NeedleCleanViewTemplate" DataType="{x:Type needle:NeedleCleanViewModel}">
                <!--<sharprender:RenderControl RenderLayerData="{Binding MainRenderLayer}" Width="{Binding SheetWidth}" Height="{Binding SheetHeight}"/>-->
                <needle:NeedleCleanView/>
            </DataTemplate>
            <conv:TemperatureUnitConverter x:Key="TempUnitConvc"/>
            <conv:ViewTargetConverter x:Key="ViewTargetConverter"/>
            <conv:LotStateToStringConverter3 x:Key="BtoVConv2"/>
            <conv:LotTimeConverter x:Key="LotTimeConverter"/>
            <conv:LampTypeToBrushConverter x:Key="LampTypeToBrushConverter"/>
            <pnpcontrol:TemplateSelector x:Key="ViewTargetTemplateSelector" 
                                    MapViewDataTemplate="{StaticResource MapViewTemplate}"
                                    DisplayViewDataTemplate="{StaticResource DisplayViewTemplate}"
                                    NeedleCleanDataTemplate="{StaticResource NeedleCleanViewTemplate}"/>
        </ResourceDictionary>
    </Window.Resources>
    <Grid Background="Black">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" BorderBrush="#FFd6d9f4" BorderThickness="0.5" CornerRadius="2" Margin="1">
                <Grid HorizontalAlignment="Center" Margin="4">
                    <Ellipse Fill="Gray" Height="36" Width="36" Stroke="Gray" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <!--<Ellipse x:Name="StatusIndicator" Fill="{Binding LotOPModule.CurrentModuleState, Converter={StaticResource BtoVConv}}" Height="80" Width="80" Stroke="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/>-->
                    <!--<Ellipse x:Name="StatusIndicator" Height="34" Width="34" Fill="{Binding LampManager.OnLampType, Converter={StaticResource LampTypeToBrushConverter}}" Stroke="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/>-->
                    <Ellipse x:Name="StatusIndicator" Height="34" Width="34" 
                             Stroke="Black" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Ellipse.Fill>
                            <MultiBinding Converter="{StaticResource LampTypeToBrushConverter}">
                                <Binding Path="LampManager.OnLampType"></Binding>
                                <Binding Path="LotOPModule.ModuleState.State"></Binding>
                            </MultiBinding>
                        </Ellipse.Fill>
                    </Ellipse>

                    <Ellipse Height="32" Width="32" Stroke="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Ellipse.Fill>
                            <RadialGradientBrush GradientOrigin="0.2,0.2" Center="0.2,0.2" RadiusX="0.8" RadiusY="0.8">
                                <GradientStop Color="#ffffff" Offset="0" />
                                <GradientStop Color="Transparent" Offset="1" />
                            </RadialGradientBrush>
                        </Ellipse.Fill>
                    </Ellipse>
                    <Label Style="{x:Null}" VerticalContentAlignment="Center" HorizontalAlignment="Center" >
                        <Grid>
                            <TextBlock Grid.Row="1" Text="{Binding LotOPModule.CurrentModuleState, Converter={StaticResource BtoVConv2}}" FontSize="12"/>
                        </Grid>
                    </Label>

                    <!--<Ellipse Fill="Gray" Height="36" Width="36" Stroke="Gray" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <Ellipse x:Name="StatusIndicator" Fill="{Binding LotOPModule.CurrentModuleState, Converter={StaticResource BtoVConv}}" Height="32" Width="32" Stroke="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <Ellipse Height="32" Width="32" Stroke="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Ellipse.Fill>
                            <RadialGradientBrush GradientOrigin="0.2,0.2" Center="0.2,0.2" RadiusX="0.8" RadiusY="0.8">
                                <GradientStop Color="#ffffff" Offset="0" />
                                <GradientStop Color="Transparent" Offset="1" />
                            </RadialGradientBrush>
                        </Ellipse.Fill>
                    </Ellipse>-->
                    <!--<Label Style="{x:Null}" VerticalContentAlignment="Center" HorizontalAlignment="Center" >
                    <Grid>
                        <TextBlock Grid.Row="1" Text="{Binding LotOPModule.CurrentModuleState, Converter={StaticResource BtoVConv2}}" FontSize="16"/>
                    </Grid>
                </Label>-->
                </Grid>
            </Border>

            <Border Grid.Column="1" BorderBrush="#FFd6d9f4" BorderThickness="0.5" CornerRadius="2" Margin="1">
                <Label Grid.Column="0" Padding="2" Margin="1" Style="{x:Null}" Foreground="LightGray" VerticalContentAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="4" Text="{Binding Temp.TempInfo.SetTemp.Value, 
                            StringFormat=Set {0:0.0}℃}" FontSize="24"/>
                        <!--<TextBlock Margin="4" Text="{Binding Temp.TempInfo.SetTemp.Value, Converter={StaticResource TempUnitConvc},StringFormat=Set {0:0.0}℃}" FontSize="24"/>-->
                    </StackPanel>
                </Label>
            </Border>

            <Border Grid.Column="2" BorderBrush="#FFd6d9f4" BorderThickness="0.5" CornerRadius="2" Margin="1">
                <Label Padding="2" Margin="1" Style="{x:Null}" Foreground="LightGray" VerticalContentAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="4" Text="{Binding Temp.TempInfo.CurTemp.Value, 
                            StringFormat=Cur {0:0.0}℃}" FontSize="24"/>
                        <!--<TextBlock Margin="4" Text="{Binding Temp.TempInfo.CurTemp.Value, Converter={StaticResource TempUnitConvc},StringFormat=Cur {0:0.0}℃}" FontSize="24"/>-->
                    </StackPanel>
                </Label>
            </Border>

            <Border Grid.Column="3" BorderBrush="LightBlue" BorderThickness="0.5" CornerRadius="2" Margin="1">
                <Label Padding="2" Margin="1" Style="{x:Null}" Foreground="LightGray" VerticalContentAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="4" Text="{Binding Temp.TempInfo.DewPoint.Value, 
                            StringFormat=DP {0:0.0}℃}" FontSize="24"/>
                    </StackPanel>
                </Label>
            </Border>

        </Grid>

        <Grid Grid.Row="1">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" BorderBrush="#FFd6d9f4" BorderThickness="0.5" CornerRadius="2" Margin="1">
                <ContentControl Width="300" Height="300" 
                                Content="{Binding LotOPModule.ViewTarget ,Converter={StaticResource ViewTargetConverter}}" 
                                VerticalAlignment="Stretch" 
                                HorizontalAlignment="Stretch" />
            </Border>

            <Grid Grid.Column="1">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>

                <Border Grid.ColumnSpan="2" BorderBrush="#FFd6d9f4" BorderThickness="0.5" CornerRadius="2" Margin="1">

                </Border>
                <StackPanel Orientation="Vertical" Grid.Column="0">
                    <Label Content="LOT Name" 
                                               Margin="0" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Device Name" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Operator ID" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Current Wafer ID" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Cassette ID" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Lot Start Time "  FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Lot End Time "  FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Passed Die Count" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Failed Die Count" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Tested Die Count" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Total  Die Count" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="Probing Yieid" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                </StackPanel>

                <StackPanel Orientation="Vertical" Grid.Column="1">

                    <Label Content="{Binding LotModule.LotInfo.LotName.Value}" 
                                               ContentStringFormat=":  {0}" 
                                               Margin="0" FontSize="12"
                                               Style="{DynamicResource ContentLabel}"/>
                    <TextBlock Text="{Binding LotModule.LotInfo.DeviceName.Value, StringFormat={} :  {0}}" FontSize="12"
                                               Foreground="#d9d9d9"
                                               />
                    <Label Content="{Binding LotModule.LotInfo.OperatorID.Value}" FontSize="12"
                                               ContentStringFormat=":  {0}"  
                                               Style="{DynamicResource ContentLabel}"/>
                    <!--<Label Content="{Binding Wafer.WaferDevObject.PhysInfo.WaferID.Value}" FontSize="12"-->
                    <Label Content="{Binding Wafer.WaferDevObject.Info.WaferID.Value}" FontSize="12"
                                               ContentStringFormat=":  {0}"  
                                               Style="{DynamicResource ContentLabel}"/>
                    <!--<Label Content="{Binding Wafer.WaferDevObject.PhysInfo.CassetteID.Value}" FontSize="12"-->
                    <Label Content="{Binding Wafer.WaferDevObject.Info.CassetteID}" FontSize="12"
                                               ContentStringFormat=":  {0}" 
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label  FontSize="12"
                                               ContentStringFormat=":  {0}" 
                                               Style="{DynamicResource ContentLabel}">
                        <Label.Content>
                            <MultiBinding Converter="{StaticResource LotTimeConverter}">
                                <Binding Path="LotModule.LotInfo.LotStartTime"/>
                                <Binding Path="LotModule.LotInfo.LotStartTimeEnable"/>
                            </MultiBinding>
                        </Label.Content>
                    </Label>
                    <Label  FontSize="12"
                                               ContentStringFormat=":  {0}" 
                                               Style="{DynamicResource ContentLabel}">
                        <Label.Content>
                            <MultiBinding Converter="{StaticResource LotTimeConverter}">
                                <Binding Path="LotModule.LotInfo.LotEndTime"/>
                                <Binding Path="LotModule.LotInfo.LotEndTimeEnable"/>
                            </MultiBinding>
                        </Label.Content>
                    </Label>

                    <Label Content="{Binding Wafer.WaferDevObject.Info.CurPassedDieCount.Value}" FontSize="12"
                                               ContentStringFormat=":  {0} "
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="{Binding Wafer.WaferDevObject.Info.CurFailedDieCount.Value}" FontSize="12"
                                               ContentStringFormat=":  {0} "
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="{Binding Wafer.WaferDevObject.Info.CurTestedDieCount.Value}" FontSize="12"
                                               ContentStringFormat=":  {0} " 
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="{Binding Wafer.WaferDevObject.Info.TestDieCount.Value}" FontSize="12"
                                               ContentStringFormat=":  {0} " 
                                               Style="{DynamicResource ContentLabel}"/>
                    <Label Content="{Binding Wafer.WaferDevObject.Info.Yield}" FontSize="12"
                                               ContentStringFormat=":  {0:0.###} %" 
                                               Style="{DynamicResource ContentLabel}"/>

                </StackPanel>

            </Grid>

        </Grid>
    </Grid>
</Controls:MetroWindow>
